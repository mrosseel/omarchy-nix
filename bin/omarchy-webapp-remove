#!/usr/bin/env bash
# Remove installed webapps

ICON_DIR="$HOME/.local/share/applications/icons"
DESKTOP_DIR="$HOME/.local/share/applications"

if [ "$#" -eq 0 ]; then
  echo "Usage: omarchy-webapp-remove <app-name> [app-name...]"
  echo ""
  echo "Installed webapps:"

  # Find all webapps (desktop files in user directory that aren't system apps)
  found=false
  while IFS= read -r -d '' file; do
    # Check if it's a webapp (has --app flag or Categories=WebApp)
    if grep -q -E '(--app=|Categories=.*WebApp)' "$file" 2>/dev/null; then
      basename="${file##*/}"
      app_name="${basename%.desktop}"
      echo "  - $app_name"
      found=true
    fi
  done < <(find "$DESKTOP_DIR" -maxdepth 1 -name '*.desktop' -type f -print0 2>/dev/null)

  if [ "$found" = false ]; then
    echo "  (none)"
  fi

  echo ""
  echo "Example: omarchy-webapp-remove Gmail Notion"
  exit 0
fi

# Remove specified webapps
for APP_NAME in "$@"; do
  DESKTOP_FILE="$DESKTOP_DIR/$APP_NAME.desktop"
  ICON_FILE="$ICON_DIR/$APP_NAME.png"

  if [ -f "$DESKTOP_FILE" ]; then
    rm -f "$DESKTOP_FILE"
    rm -f "$ICON_FILE"
    echo "✓ Removed: $APP_NAME"
  else
    echo "✗ Not found: $APP_NAME"
  fi
done
