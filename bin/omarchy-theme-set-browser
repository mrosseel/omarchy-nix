#!/usr/bin/env bash
# Apply current theme to browser (Chromium/Brave)

# Get current theme from colorScheme
THEME_NAME="${OMARCHY_THEME:-tokyo-night}"

echo "Applying theme to browser: $THEME_NAME"

# Determine browser config directory
if pgrep -x "brave" >/dev/null || command -v brave >/dev/null 2>&1; then
  BROWSER_DIR="$HOME/.config/BraveSoftware/Brave-Browser"
  BROWSER_NAME="Brave"
elif pgrep -x "chromium" >/dev/null || command -v chromium >/dev/null 2>&1; then
  BROWSER_DIR="$HOME/.config/chromium"
  BROWSER_NAME="Chromium"
else
  echo "No supported browser found (Chromium or Brave)"
  exit 1
fi

# Create preferences directory if it doesn't exist
PREFS_DIR="$BROWSER_DIR/Default"
mkdir -p "$PREFS_DIR"

# Determine if dark or light theme
if [ -f "$HOME/.config/omarchy/theme/light.mode" ]; then
  GTK_THEME="light"
else
  GTK_THEME="dark"
fi

echo "Setting $BROWSER_NAME to use $GTK_THEME mode"
echo "Theme will apply on next browser restart"

# The browser will automatically use GTK theme settings
# which are already configured by the home-manager module

notify-send "Browser Theme" "$BROWSER_NAME set to $GTK_THEME mode - restart browser to apply" -u low

echo ""
echo "Browser theme configured!"
echo "Restart $BROWSER_NAME to see changes"
